from fastapi import FastAPI
from pydantic import BaseModel
from parsivar import Normalizer, Tokenizer, FindStems

app = FastAPI()

# Initialize Parsivar tools
normalizer = Normalizer(statistical_space_correction=True)
tokenizer = Tokenizer()
stemmer = FindStems()

class CommentRequest(BaseModel):
    comment: str

class SentimentResponse(BaseModel):
    sentiment: str

# Simple rule-based sentiment analysis
def simple_sentiment_analysis(text):
    positive_keywords = [
    "عالی", "خوب", "دوست داشتنی", "محبوب", "عاشق", "خوشحال", "شگفت‌انگیز", "فوق‌العاده", "راضی", 
    "موفق", "شاد", "زیبا", "تمیز", "عاشقانه", "لذت‌بخش", "بزرگ", "مثبت", "گرم", "بهتر", 
    "بی‌نظیر", "رضایت‌بخش", "امیدوار", "قوی", "هیجان‌انگیز", "دل‌نشین", "دلپذیر", "پیشرفت", 
    "جذاب", "خوشبخت", "آرام", "معجزه‌آسا", "محترم", "سپاسگزار", "آسوده", "محکم", "مهم", 
    "بی‌همتا", "بی‌نقص", "حرفه‌ای", "افتخار", "پایدار", "برجسته", "مشهور", "فرح‌بخش", 
    "شایسته", "درخشان", "منحصربه‌فرد", "پرفکت", "رضایت", "گوارا", "قابل‌اعتماد", "پرنور", 
    "قدرتمند", "دوست‌داشتنی", "نورانی", "خوشمزه", "تازگی", "هوشمندانه", "پرمهر", "آرام‌بخش", 
    "جالب", "لذت‌آور", "ساده", "خاص", "افتخاری", "ارزشمند", "پرشور", "درجه‌یک", "قابل‌توجه", 
    "پرحال", "محکم", "بی‌بدیل", "بی‌قیاس", "دوست‌داشتنی", "لطیف", "مهربان", "پرانرژی", 
    "بی‌خطر", "قابل‌تحسین", "تمجیدآمیز", "طراوت‌بخش", "موثر", "بی‌عیب", "مهم", "دوستانه", 
    "پرکاربرد", "شیرین", "بی‌همتا", "عشق‌ورز", "قابل‌قبول", "پرزرق‌وبرق", "استثنایی", 
    "شادمان", "پرهیجان", "دوست‌داشتنی", "آسمانی", "نجیب", "بهترین", "لذیذ", "زیبایی", 
    "روح‌بخش", "الهام‌بخش", "موفقیت‌آمیز", "بی‌انتهای", "مشعوف", "فرخنده", "پیروز", 
    "عاشق‌پیشه", "خوشرو", "عالی‌قدر", "بدرخش", "مطلوب", "موفقیت", "شایسته", "نیک‌سرشت", 
    "گوارا", "منصف", "مهرآمیز", "والا", "همراه", "بشاش", "گلچین", "دوست", "تاثیرگذار", 
    "استوار", "نیکو", "استثنایی", "پایدار", "باارزش", "خوشحال", "مسرت‌بخش", "تابناک", 
    "پرشکوه", "باافتخار", "فروغ‌بخش", "متحرک", "بهره‌مند", "لطیف", "نیک", "نیک‌اندیش", 
    "شگفت‌انگیز", "پرشور", "لطیف", "نیک‌بخت", "آرامش‌بخش", "نورانی", "دین‌دار", "آزاد", 
    "بالنده", "فرهیخته", "سرافراز", "پرتلاش", "پرمحتوا", "گل‌سرسبد", "طلایی", "بخشنده"
    ]

    negative_keywords = [
    "بد", "وحشتناک", "نفرت", "غمگین", "ناامید", "ضعیف", "بیمزه", "بی‌ارزش", "ناجور", 
    "افتضاح", "ناشی", "بدبخت", "بیچاره", "شرم‌آور", "دلگیر", "بی‌فایده", "حقیر", "ترسناک", 
    "دل‌خراش", "منفی", "تلخ", "ناراحت", "ملال‌آور", "بی‌روح", "زشت", "نامناسب", "ناجالب", 
    "ناراضی", "دل‌چرکین", "تاسف‌آور", "مزخرف", "آزاردهنده", "غم‌انگیز", "دل‌شکسته", 
    "نفرت‌انگیز", "بی‌کفایت", "ملال‌آور", "بی‌مصرف", "بی‌ارزش", "بی‌احساس", "تنبل", 
    "ناتوان", "بی‌کیفیت", "وحشت‌انگیز", "عذاب‌آور", "مخرب", "خشمگین", "غیرقابل‌تحمل", 
    "مایوس", "بی‌حس", "دلهره‌آور", "ضایع", "بی‌رحم", "عصبی", "ناراحت‌کننده", "غم‌خوار", 
    "نفرت‌آور", "دلخراش", "بیزار", "مزاحم", "ناامیدکننده", "بی‌ادب", "وحشتناک", 
    "ضدحال", "پریشان", "خسته‌کننده", "بدبین", "مشکل‌ساز", "نفرت‌انگیز", "بی‌اعتبار", 
    "بی‌معنی", "بی‌ربط", "بی‌اخلاق", "فریبنده", "بی‌حاصل", "بی‌حساب", "بی‌خلاقیت", 
    "ملال‌آور", "خفقان‌آور", "ناراحت", "کثیف", "وحشی", "درنده", "ناراحت", "ناراحتی", 
    "بیزاری", "بی‌ثبات", "پست", "ترسناک", "تلخ", "بداندیش", "بیمار", "بی‌سرپرست", 
    "خائن", "شکست", "شرم‌آور", "ملامت", "سرزنش", "حقارت‌آمیز", "بی‌لیاقت", "بی‌شرم", 
    "نابخرد", "ملامت‌آور", "بی‌احساس", "پرخاشگر", "غم‌آور", "تخریب‌کننده", "نفرت‌انگیز", 
    "بیرحم", "بدصفت", "ناراضی", "منزجر", "نفرت‌زده", "دلسردکننده", "ترسناک", "ناامید", 
    "کینه‌توز", "بدجنس", "منحوس", "دردناک", "مضر", "ناراحت", "پریشان‌حال", "سنگ‌دل", 
    "نفرت‌آلود", "بی‌مروت", "مزاحم", "قابل‌تنفر", "بدشانس", "بی‌درد", "ضدقهرمان", 
    "ناخوشایند", "تاریک", "بی‌احترام", "بی‌معرفت", "ناپاک", "بدذوق", "ناسالم", "عقده‌ای", 
    "گمراه", "توهین‌آمیز", "تحقیرآمیز", "گرفتار", "بی‌وجدان", "خسته", "دل‌آزار", "بدکردار", 
    "وحشت‌برانگیز", "دردسرساز", "بی‌خواب", "غیرانسانی", "وحشیانه", "غیرقانونی", 
    "بداقبال", "مرده‌دل", "کینه‌آلود", "غیراخلاقی", "فاسد", "بی‌معرفت", "بدگمان", 
    "ناراحتی", "بی‌اعتبار", "بی‌وجدان", "تنگ‌نظر", "بدزبان", "خشن", "مغرض", "عذاب", 
    "سخت", "زشت", "ناراحت‌کننده", "گناه", "خطاکار", "بدذات", "وحشت‌زا", "پست", 
    "قساوت", "نفرت", "ناپاک", "مزخرف", "غیرمجاز", "خطرناک", "آزارگر", "مسموم", 
    "قساوت‌آمیز", "شرارت", "تباه", "نفرین‌شده", "بی‌وجدان", "افسرده", "بی‌حال", 
    "سرخورده", "ملول", "غمناک", "نگران‌کننده", "بی‌حاصل", "ناشایست", "درمانده", 
    "غم‌افزا", "دلهره‌آور", "بی‌شرمانه", "بی‌حیا", "تنفربرانگیز", "خبیث", "بدون‌شرف", 
    "بی‌عاطفه", "نابودگر", "اهریمنی", "مبهم", "خطرناک", "ویرانگر", "بی‌عدالت", 
    "نفرت‌انگیز", "دشمن‌طور", "پست‌فطرت", "بدکار", "بیمارگونه", "خبیث", "بدجنس", 
    "گمراه‌کننده", "فرومایه", "بی‌رحمانه", "ملعون", "تباه‌کار", "شیطانی", "دورغین", 
    "شرور", "بی‌وجدان", "نفرت‌آمیز", "بی‌وجدان", "بدخیم", "مضطرب", "بی‌معرفت", "ننگین", "مضخرف"
    ]


    # Normalize and tokenize the text
    normalized_text = normalizer.normalize(text)
    tokens = tokenizer.tokenize_words(normalized_text)
    
    # Check for sentiment keywords
    positive_count = sum(1 for word in tokens if word in positive_keywords)
    negative_count = sum(1 for word in tokens if word in negative_keywords)

    if positive_count > negative_count:
        return "good"
    elif negative_count > positive_count:
        return "bad"
    else:
        return "neutral"

@app.post("/analyze-sentiment", response_model=SentimentResponse)
async def analyze_sentiment(request: CommentRequest):
    sentiment = simple_sentiment_analysis(request.comment)
    return SentimentResponse(sentiment=sentiment)
